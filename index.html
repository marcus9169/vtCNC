<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">

  <title>The HTML5 Herald</title>
  <meta name="description" content="The HTML5 Herald">
  <meta name="author" content="SitePoint">

  <script
  src="https://code.jquery.com/jquery-3.3.1.min.js"
  integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
  crossorigin="anonymous"></script>

  <link rel="stylesheet" href="node_modules/xterm/dist/xterm.css" />
  <script src="node_modules/xterm/dist/xterm.js"></script> 

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" />
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>

  <!--[if lt IE 9]>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.js"></script>
  <![endif]-->

  <script>
    var term, ws;

    function sendCmd(e) {
        var btn = $(e.currentTarget)
        var cmd = $('#cmdLine').val();
        ws.send(cmd);
    }

    function WebSocketStart()
     {
        if ("WebSocket" in window)
        {

           // Let us open a web socket
           ws = new WebSocket("ws://localhost:8080/","echo-protocol");
            
           ws.onopen = function()
           {

                term = new Terminal();
                term.open(document.getElementById('terminal'));         

                $('#go').on('click', sendCmd);

           };
            
           ws.onmessage = function (evt) 
           { 
              var received_msg = evt.data;
              //alert(received_msg);
              //$('body').append(received_msg);
              term.writeln(received_msg)
           };
            
           ws.onclose = function()
           { 
              // websocket is closed.
              alert("Connection is closed..."); 
           };
                
           window.onbeforeunload = function(event) {
              socket.close();
           };

        }
        
        else
        {
           // The browser doesn't support WebSocket
           alert("WebSocket NOT supported by your Browser!");
        }
     }
    $( document ).ready(function() {
        WebSocketStart();
    });
</script>
</head>

<body>
    <div class="row">
        <div class="col-md-3">
            <div class="input-group">
                <input id='cmdLine' type="text" class="form-control" placeholder="Command">
                    <span class="input-group-btn">
                          <button id='go' class="btn btn-default" type="button">Go!</button>
                </span>
            </div><!-- /input-group -->
        </div>
        <div class="col-md-3">
            <div id="terminal"></div>
        </div>
    </div>


    <!-- <script>
    
      term.open(document.getElementById('terminal'));
      term.write('Hello from \033[1;3;31mxterm.js\033[0m $ ')
    </script>  -->

</body>
</html>